# coub-downloader
⚠️ Пока что скачанные файлы нужно объединять вручную

Запуск:
```
yarn
yarn build
start:prod <start> <end>
```
`start`/`prod` - айди из ссылки на просмотр (например https://coub.com/view/100000)
Пример запуска: `yarn start:prod 100000 200000`

В результате создастся sqlite база `pages_100000_200000.db`. Воркер проходит перебором по всем айди в диапазоне и скачивает метаинфу.
В случае редиректа пишет в базу ссылку на редирект.
Желательно запускать несколько воркеров параллельно, указав небольшой диапазон айди для каждого

После скачивания метаданных, можно качать сами коубы:
```
yarn
yarn build
yarn download "D:\coub-db\pages_100000_140000.db" "D:\coub-dump\"
yarn download "D:\coub-db\pages_100000_140000.db" "D:\coub-dump\" 11a001 11a00f
```
В итоговой папке будут созданы подпапки с айдишником коуба и файлами `input.mp4` и `input.mp3` (если в коубе есть звук)
Если указать диапазон айдишников, то будут качаться только коубы в указанном диапазоне.

Для объединения потоков в итоговый коуб, нужно запустить:
`ffmpeg  -stream_loop -1 -i input.mp4 -i input.mp3 -shortest -map 0:v:0 -map 1:a:0 -y out.mp4`
Это создаст коуб, в котором видео будет зациклено по длине аудио
